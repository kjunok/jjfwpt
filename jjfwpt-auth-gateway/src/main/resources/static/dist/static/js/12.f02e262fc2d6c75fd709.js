webpackJsonp([12],{KUNB:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("mvHQ"),i=o.n(a),n={components:{IconSelect:o("qNfb").a},props:["clientHeight"],data:function(){return{menuIndex:{},menuIndexData:{},keyword:"",uploadHeader:{token:sessionStorage.getItem("token")},styles:{height:"calc(100% - 55px)",overflow:"auto",paddingBottom:"53px",position:"static"},menuInfoGrid:{columns:[{title:"名称",slot:"name",key:"name",width:350,fixed:"left"},{title:"操作",slot:"action",width:150,fixed:"left",align:"center"},{title:"状态",key:"state",slot:"state",width:150},{title:"排序",key:"orderNum",width:150},{title:"类型",key:"type",slot:"type",width:150,filters:[{label:"功能模块",value:1},{label:"模块菜单",value:2},{label:"菜单权限",value:3}],filterMethod:function(e,t){return 1===e?"1"===t.type:2===e?"2"===t.type:3===e?"3"===t.type:void 0}},{title:"所属组",key:"groupName",width:150},{title:"视图路径",key:"viewPath",width:150},{title:"创建人",key:"createUserId",width:150},{title:"创建时间",key:"createTime",width:150},{title:"修改人",key:"updateUserId",width:150},{title:"修改日期",key:"updateTime",width:150}],data:[],pageData:{total:100,current:1,size:10}},menuForm:{title:"添加",iconSelect:!1,showField:{groupName:!1,pid:!1,viewPath:!1},select:{pid:[]},clearData:{id:"",name:"",pid:"",viewPath:"",type:"1",state:"0",orderNum:1,groupName:"",icon:"md-help",description:"",desc:""},uploadError:!1,data:{id:"",name:"",pid:"",viewPath:"",type:"1",state:"0",icon:"md-help",iconFile:null,orderNum:1,groupName:"",description:"",desc:""},validate:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],pid:[{required:!0,message:"请选择父菜单",trigger:"change"}],type:[{required:!0,message:"请选择类型",trigger:"change"}]},show:!1,menuView:{data:{},show:!1}}}},methods:{searchMenus:function(){if(""==this.keyword)this.showOrHideRow(this.menuInfoGrid.data,!0),this.$jq(".row-0").show();else{this.showOrHideRow(this.menuInfoGrid.data,!0);var e=this.keyword;for(var t in this.menuIndex)if(t.indexOf(e)>-1){var o=this.menuIndex[t];this.$jq(".search-"+o.id).show(),this.cascadParentMenuShow(this.menuIndexData[o.pid])}}},cascadParentMenuShow:function(e){e&&(this.$jq(".search-"+e.id).show(),this.$jq(".drop"+e.id).addClass("ivu-icon-ios-arrow-down").removeClass("ivu-icon-ios-arrow-forward"),this.cascadParentMenuShow(this.menuIndexData[e.pid]))},rowClassName:function(e,t){return this.menuIndexData[e.id]=e,this.menuIndex[e.name+"__"+t]=e,"2"==e.type||"3"==e.type?(e.closed=!0,"row-"+e.pid+" row-hidden search-"+e.id):(e.closed=!1,"row-"+e.pid+" search-"+e.id)},showOrHide:function(e){void 0==e.closed&&(e.closed=!0),e.closed?(this.showOrHideRow(e.children,!1),this.$jq(".drop"+e.id).addClass("ivu-icon-ios-arrow-down").removeClass("ivu-icon-ios-arrow-forward"),e.closed=!1):(this.showOrHideRow(e.children,!0),this.$jq(".drop"+e.id).addClass("ivu-icon-ios-arrow-forward").removeClass("ivu-icon-ios-arrow-down"),e.closed=!0)},showOrHideRow:function(e,t){if(e.length>0)for(var o in e){var a=e[o];t?(this.$jq(".row-"+a.pid).hide(),this.$jq(".drop"+a.id).addClass("ivu-icon-ios-arrow-forward").removeClass("ivu-icon-ios-arrow-down"),this.showOrHideRow(a.children,t)):this.$jq(".row-"+a.pid).show()}},showMenuView:function(e){this.menuForm.menuView.show=!0,this.menuForm.menuView.data=this.menuInfoGrid.data[e]},removeMenu:function(e){var t=this;t.$Modal.confirm({title:"警告",content:"确定要删除吗？",onOk:function(){t.$util.req("/api/menuService/delMenu").setJsonDataStr({ids:e.id}).setSuccessfn(function(e){1e3===e.code&&(t.$Notice.success({title:"操作成功",desc:"菜单删除成功"}),t.searchMenuList())}).go(t)}})},changeType:function(e,t){if(t=t||function(){},"1"==e)this.menuForm.showField.pid=!1,this.menuForm.showField.viewPath=!1,this.menuForm.showField.groupName=!1,this.menuForm.data.pid="0",t();else if("2"==e||"3"==e){"2"==e&&(this.menuForm.showField.groupName=!0),"3"==e&&(this.menuForm.showField.groupName=!1),this.menuForm.showField.pid=!0,this.menuForm.showField.viewPath=!0;var o=this;o.$util.req("/api/menuService/getParentMenuList").setJsonDataStr({type:e}).setSuccessfn(function(e){o.menuForm.select.pid=e.data,t()}).go(o)}},selectIcon:function(e){e(this),this.menuForm.data.iconFile=null},uploadSuccess:function(e,t,o){var a=e.data;this.menuForm.data.icon=a[0]+"/"+a[1],console.log(e,t,o)},uploadError:function(e,t){var o=this;"201"===t.statusCode&&o.$Modal.warning({title:"登录已过期",content:"请重新登录",width:400,onOk:function(){sessionStorage.setItem("history",o.$route.path),o.$router.push({path:"/login"})}})},beforeUpload:function(e){if(e.size<=1e5){this.menuForm.uploadError=!1,this.menuForm.data.iconFile=e;var t=URL.createObjectURL(e);this.menuForm.data.icon=t}else this.menuForm.uploadError=!0;return!1},saveOrUpdateMenuForm:function(e,t){if("add"===e)this.menuForm.title="添加",this.menuForm.data=this.menuForm.clearData,this.changeType(t.type);else if("update"===e){this.menuForm.title="修改";var o=this;o.$util.req("/api/menuService/searchMenu").setJsonDataStr({id:t.id}).setSuccessfn(function(e){var t=e.data;console.log(t),o.changeType(t.type,function(){o.menuForm.data=t})}).go(o)}this.menuForm.show=!0},saveOrUpdateMenu:function(e){var t=this,o=new FormData;this.$refs[e].validate(function(e){if(e){o.append("menuInfo",encodeURI(i()(t.menuForm.data))),o.append("iconFile",t.menuForm.data.iconFile);var a=t;a.$jq.ajax({url:"/api/menuService/saveOrUpdate",dataType:"json",type:"POST",async:!1,beforeSend:function(e){e.setRequestHeader("token",sessionStorage.getItem("token"))},data:o,processData:!1,contentType:!1,success:function(e){1e3===e.code&&(a.$Notice.success({title:"操作成功",desc:"菜单"+a.menuForm.title+"成功"}),a.searchMenuList(),a.menuForm.show=!1)},error:function(e){console.log(e)}})}})},searchMenuList:function(){var e=this;e.$util.req("/api/menuService/searchMenuTreeSortList").setJsonDataStr({}).setSuccessfn(function(t){t.success&&(e.menuInfoGrid.data=t.data)}).setErrorfn(function(e){}).go(e)},changePageNum:function(e){this.menuInfoGrid.pageData.current=e,this.searchMenuList()},changePageSize:function(e){this.menuInfoGrid.pageData.size=e,this.searchMenuList()}},mounted:function(){this.searchMenuList()}},r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticStyle:{background:"rgba(0, 0, 0, 0.36)"}},[o("Card",{staticStyle:{width:"100%",background:"rgba(0, 0, 0, 0.36)",border:"none","border-bottom":"white 1px solid"}},[o("Icon",{attrs:{type:"ios-bulb"}}),e._v("\n    说明\n    "),o("span",{staticStyle:{color:"#ffabfa"}},[e._v("菜单管理")])],1),e._v(" "),o("Tabs",{staticStyle:{color:"white","font-weight":"bold"}},[o("TabPane",{attrs:{label:"菜单列表",icon:"logo-apple"}},[o("Card",{staticStyle:{width:"100%",padding:"0px",background:"rgba(0, 0, 0, 0.36)","margin-top":"-15px"},attrs:{bordered:!1}},[o("div",{staticStyle:{margin:"-5px 10px 10px 0px"}},[o("Button",{staticStyle:{float:"right"},attrs:{icon:"md-add",type:"default",shape:"circle",ghost:""},on:{click:function(t){return e.saveOrUpdateMenuForm("add",{type:"1"})}}},[e._v("增加\n          ")]),e._v(" "),o("Input",{staticStyle:{width:"500px"},attrs:{placeholder:"搜索关键字"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[o("Button",{attrs:{slot:"append",icon:"ios-search"},on:{click:e.searchMenus},slot:"append"})],1)],1),e._v(" "),o("Table",{ref:"table",staticStyle:{background:"rgba(0, 0, 0, 0.36)"},attrs:{height:e.clientHeight+45,columns:e.menuInfoGrid.columns,"row-class-name":e.rowClassName,data:e.menuInfoGrid.data,showStripe:""},scopedSlots:e._u([{key:"name",fn:function(t){var a=t.row;return[o("Row",[2==a.type?o("Col",{attrs:{span:"4"}},[e._v(" ")]):e._e(),e._v(" "),3==a.type?o("Col",{attrs:{span:"8"}},[e._v(" ")]):e._e(),e._v(" "),o("Col",{attrs:{span:16}},[o("div",{staticStyle:{color:"rgba(13,30,13,0.58)","border-radius":"20px","line-height":"40px"},style:{color:2==a.type?"#2d8cf0":3==a.type?"green":"yellow"},on:{click:function(t){return e.showOrHide(a)}}},[a.children.length>0?o("Icon",{class:"treeActionBtn drop"+a.id,staticStyle:{color:"lightblue"},attrs:{size:"20",type:"ios-arrow-forward"}}):e._e(),e._v(" "),0==a.children.length?o("Icon",{staticStyle:{color:"rgba(0,0,0,0)"},attrs:{size:"20",type:"md-arrow-dropright-circle"}}):e._e(),e._v(" "),-1==a.icon.indexOf("/")?o("Icon",{attrs:{size:"30",type:a.icon}}):e._e(),e._v(" "),a.icon.indexOf("/")>-0?o("img",{staticClass:"ivu-icon",staticStyle:{"border-radius":"5px"},attrs:{src:"/api/file/"+a.icon,width:"25",height:"25"}}):e._e(),e._v("\n                    \n                  "),o("strong",[e._v(e._s(a.name))]),e._v("  \n                  ")],1)])],1)]}},{key:"state",fn:function(t){var a=t.row;return[o("strong",[e._v(e._s(e.$util.localDict.menuinfo.state[a.state]))])]}},{key:"type",fn:function(t){var a=t.row;return[o("strong",[e._v(e._s(e.$util.localDict.menuinfo.type[a.type]))])]}},{key:"action",fn:function(t){var a=t.row,i=t.index;return[o("div",{staticStyle:{"text-align":"right"}},[2==a.type||1==a.type?o("Icon",{staticStyle:{color:"#3862f5"},attrs:{size:"25",type:"md-add-circle"},on:{click:function(t){return e.saveOrUpdateMenuForm("add",{type:a.type,id:a.id})}}}):e._e(),e._v(" "),o("Icon",{staticStyle:{color:"lightblue"},attrs:{size:"25",type:"md-search"},on:{click:function(t){return e.showMenuView(i)}}}),e._v(" "),o("Icon",{staticStyle:{color:"green"},attrs:{size:"25",type:"ios-create"},on:{click:function(t){return e.saveOrUpdateMenuForm("update",{type:a.type,id:a.id})}}}),e._v(" "),o("Icon",{staticStyle:{color:"red"},attrs:{size:"25",type:"ios-trash"},on:{click:function(t){return e.removeMenu({id:a.id})}}})],1)]}}])})],1)],1)],1),e._v(" "),o("Drawer",{attrs:{draggable:"",closable:!1,"mask-closable":!1,width:"1000"},model:{value:e.menuForm.show,callback:function(t){e.$set(e.menuForm,"show",t)},expression:"menuForm.show"}},[o("div",{staticClass:"ivu-drawer-header"},[o("Icon",{staticClass:"drawer-close-icon",attrs:{size:"20",type:"md-close"},on:{click:function(t){e.menuForm.show=!1}}}),e._v(" "),o("div",{staticClass:"ivu-drawer-header-inner"},[e._v(e._s(e.menuForm.title))])],1),e._v(" "),o("Card",{style:{height:e.clientHeight+160+"px"},attrs:{bordered:!1}},[o("Form",{ref:"menuInfoForm",attrs:{model:e.menuForm.data,rules:e.menuForm.validate,enctype:"multipart/form-data","label-width":80}},[o("FormItem",{attrs:{label:"名称","label-position":"left",prop:"name"}},[o("Input",{attrs:{placeholder:"please enter user name"},model:{value:e.menuForm.data.name,callback:function(t){e.$set(e.menuForm.data,"name",t)},expression:"menuForm.data.name"}})],1),e._v(" "),o("FormItem",{attrs:{label:"类型","label-position":"left",prop:"type"}},[o("Select",{attrs:{placeholder:"功能模块--模块菜单--页面权限"},on:{"on-change":e.changeType},model:{value:e.menuForm.data.type,callback:function(t){e.$set(e.menuForm.data,"type",t)},expression:"menuForm.data.type"}},[o("Option",{attrs:{value:"1"}},[e._v("功能模块")]),e._v(" "),o("Option",{attrs:{value:"2"}},[e._v("模块菜单")]),e._v(" "),o("Option",{attrs:{value:"3"}},[e._v("页面权限")])],1)],1),e._v(" "),e.menuForm.showField.viewPath?o("FormItem",{attrs:{label:"页面路径","label-position":"left"}},[o("Input",{attrs:{placeholder:"视图路径"},model:{value:e.menuForm.data.viewPath,callback:function(t){e.$set(e.menuForm.data,"viewPath",t)},expression:"menuForm.data.viewPath"}})],1):e._e(),e._v(" "),e.menuForm.showField.groupName?o("FormItem",{attrs:{label:"分组名称","label-position":"left"}},[o("Input",{attrs:{placeholder:"分组名称"},model:{value:e.menuForm.data.groupName,callback:function(t){e.$set(e.menuForm.data,"groupName",t)},expression:"menuForm.data.groupName"}})],1):e._e(),e._v(" "),e.menuForm.showField.pid?o("FormItem",{attrs:{label:"父菜单","label-position":"left",prop:"pid"}},[o("Select",{attrs:{placeholder:"请选择父级",filterable:""},model:{value:e.menuForm.data.pid,callback:function(t){e.$set(e.menuForm.data,"pid",t)},expression:"menuForm.data.pid"}},e._l(e.menuForm.select.pid,function(t,a){return o("Option",{key:a,attrs:{value:t.id}},[o("Icon",{attrs:{size:"30",type:t.icon}}),e._v(e._s(t.name))],1)}),1)],1):e._e(),e._v(" "),o("FormItem",{attrs:{label:"选择图标","label-position":"left"}},[o("div",{staticStyle:{height:"80px",width:"80px",display:"block",border:"1px solid rgba(189,255,236,0.6)",cursor:"pointer","border-radius":"10px"}},[o("div",{staticStyle:{position:"relative",width:"260px"}},[e.menuForm.data.icon.indexOf("blob:")>-1?o("img",{staticClass:"ivu-icon",staticStyle:{"border-radius":"10px"},attrs:{src:e.menuForm.data.icon,width:"80",height:"80"}}):e._e(),e._v(" "),e.menuForm.data.icon.indexOf("/")>-1&&-1==e.menuForm.data.icon.indexOf("blob:")?o("img",{staticClass:"ivu-icon",staticStyle:{"border-radius":"10px"},attrs:{src:"/api/file/"+e.menuForm.data.icon,width:"80",height:"80"}}):e._e(),e._v(" "),-1==e.menuForm.data.icon.indexOf("/")?o("Icon",{attrs:{size:"80",type:e.menuForm.data.icon}}):e._e(),e._v(" "),o("span",{staticStyle:{"font-size":"10px",width:"70px","text-align":"center",position:"absolute",left:"85px",bottom:"30px",background:"#6660ff","line-height":"22px","border-radius":"5px"},on:{click:function(t){e.menuForm.iconSelect=!0}}},[e._v("选择图标")]),e._v(" "),o("span",{staticStyle:{position:"absolute",width:"70px","text-align":"center",left:"85px",bottom:"0px",background:"#ff5c4f","line-height":"22px","border-radius":"5px"}},[o("Upload",{attrs:{action:"",headers:e.uploadHeader,format:["jpg","jpeg","png"],"on-success":e.uploadSuccess,"on-error":e.uploadError,"before-upload":e.beforeUpload,"max-size":948,"show-upload-list":!1}},[e._v("\n                  上传图标\n                ")])],1),e._v(" "),e.menuForm.uploadError?o("span",{staticClass:"ivu-form-item-error-tip",staticStyle:{"margin-top":"5px"}},[e._v("超过文件大小限制,不能超过100KB!")]):e._e()],1)])]),e._v(" "),o("FormItem",{attrs:{label:"启用?","label-position":"left"}},[o("i-switch",{attrs:{"true-value":"0","false-value":"1",size:"large"},model:{value:e.menuForm.data.state,callback:function(t){e.$set(e.menuForm.data,"state",t)},expression:"menuForm.data.state"}},[o("span",{attrs:{slot:"open"},slot:"open"},[e._v("启用")]),e._v(" "),o("span",{attrs:{slot:"close"},slot:"close"},[e._v("禁用")])])],1),e._v(" "),o("FormItem",{attrs:{label:"排序","label-position":"left"}},[o("InputNumber",{staticStyle:{width:"100%"},attrs:{max:1e4,mix:1},model:{value:e.menuForm.data.orderNum,callback:function(t){e.$set(e.menuForm.data,"orderNum",t)},expression:"menuForm.data.orderNum"}})],1),e._v(" "),o("FormItem",{attrs:{label:"描述","label-position":"left"}},[o("Input",{attrs:{type:"textarea",rows:5},model:{value:e.menuForm.data.description,callback:function(t){e.$set(e.menuForm.data,"description",t)},expression:"menuForm.data.description"}})],1)],1),e._v(" "),o("div",{staticClass:"demo-drawer-footer",staticStyle:{margin:"auto"}},[o("Button",{staticStyle:{"margin-right":"8px"},on:{click:function(t){e.menuForm.show=!1}}},[e._v("取消")]),e._v(" "),o("Button",{attrs:{type:"primary"},on:{click:function(t){return e.saveOrUpdateMenu("menuInfoForm")}}},[e._v("提交")])],1)],1)],1),e._v(" "),o("IconSelect",{attrs:{clientHeight:e.clientHeight,show:e.menuForm.iconSelect},on:{iconSelectListen:e.selectIcon}}),e._v(" "),o("Drawer",{attrs:{draggable:"",closable:!1,"mask-closable":!1,width:"1000"},model:{value:e.menuForm.menuView.show,callback:function(t){e.$set(e.menuForm.menuView,"show",t)},expression:"menuForm.menuView.show"}},[o("div",{staticClass:"ivu-drawer-header"},[o("Icon",{staticClass:"drawer-close-icon",attrs:{size:"20",type:"md-close"},on:{click:function(t){e.menuForm.menuView.show=!1}}}),e._v(" "),o("div",{staticClass:"ivu-drawer-header-inner"},[e._v("详情")])],1),e._v(" "),o("Card",{staticStyle:{background:"rgba(0, 0, 0, 0.16)",height:"100%"},attrs:{bordered:!1}},e._l(e.menuInfoGrid.columns,function(t,a){return t.key?o("Row",{key:a,staticStyle:{height:"40px","margin-top":"5px",background:"rgba(4,9,7,0.2)","line-height":"35px","border-radius":"6px"},attrs:{type:"flex"}},[o("Col",{attrs:{span:"4"}},[o("div",{staticStyle:{color:"rgb(167,225,230)",padding:"5px","text-align":"center","font-weight":"bold"}},[e._v("\n            "+e._s(t.title)+"\n          ")])]),e._v(" "),o("Col",{attrs:{span:"20"}},[o("div",{staticStyle:{color:"rgba(159,216,209,0.65)",padding:"5px"}},["icon"==t.key?o("div",[o("Icon",{attrs:{size:"30",type:e.menuForm.menuView.data[t.key||t.slot]}})],1):o("div",[e.menuForm.menuView.data[t.key||t.slot]?o("span",{staticStyle:{color:"yellow"}},[e._v("\n                "+e._s(e.menuForm.menuView.data[t.key||t.slot])+"\n              ")]):o("span",[e._v("\n                ####################\n              ")])])])])],1):e._e()}),1)],1)],1)},staticRenderFns:[]};var s=o("VU/8")(n,r,!1,function(e){o("KXWM")},null,null);t.default=s.exports},KXWM:function(e,t){}});
//# sourceMappingURL=12.f02e262fc2d6c75fd709.js.map